#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\begin_preamble
\usepackage{ragged2e}
\RaggedRight
\setlength{\parindent}{20pt}
\end_preamble
\use_default_options false
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman times
\font_sans helvet
\font_typewriter courier
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 12
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_amsmath 1
\use_esint 0
\use_mhchem 0
\use_mathdots 1
\cite_engine basic
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 1in
\topmargin 1in
\rightmargin 1in
\bottommargin 1in
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Duration Models #1 v.4
\end_layout

\begin_layout Author
Paul Johnson <pauljohn@ku.edu>
\end_layout

\begin_layout Section
Let's get some math out of the way
\end_layout

\begin_layout Standard
All duration--or 
\begin_inset Quotes eld
\end_inset

hazard
\begin_inset Quotes erd
\end_inset

--models are based on the idea that, as time passes, the object under study
 can undergo an 
\begin_inset Quotes eld
\end_inset

event
\begin_inset Quotes erd
\end_inset

.
 The event might be death, quitting, getting fired, etc.
 At a given time, the probability of an event is defined as 
\begin_inset Formula $f(t)$
\end_inset

.
 
\end_layout

\begin_layout Subsection
Event probability
\end_layout

\begin_layout Standard
If the probability of an event is constant, then the model would look like
 this:
\end_layout

\begin_layout Standard
\begin_inset VSpace 0.3cm
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename importfigs/figure1.eps

\end_inset


\end_layout

\begin_layout Standard
\begin_inset VSpace 0.3cm
\end_inset


\end_layout

\begin_layout Standard
That is a 
\begin_inset Quotes eld
\end_inset

probability density function,
\begin_inset Quotes erd
\end_inset

 it gives probability over an interval from 0 to end.
\end_layout

\begin_layout Standard
The 
\begin_inset Quotes eld
\end_inset

cumulative distribution function
\begin_inset Quotes erd
\end_inset

, more commonly called just the 
\series bold
distribution function
\series default
, 
\begin_inset Formula $F(t)$
\end_inset

, tells the probability that an observation will have an event time 
\begin_inset Quotes eld
\end_inset

T
\begin_inset Quotes erd
\end_inset

 less than a given critical number 
\begin_inset Quotes eld
\end_inset

t:
\end_layout

\begin_layout Standard
\begin_inset VSpace 0.3cm
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename importfigs/flatf.eps

\end_inset


\end_layout

\begin_layout Standard
\begin_inset VSpace 0.3cm
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
F(t)=Prob(T<t)
\]

\end_inset


\end_layout

\begin_layout Subsection
Survival function
\end_layout

\begin_layout Standard
The probability that an individual observation will not have an event by
 time 
\begin_inset Quotes eld
\end_inset

t
\begin_inset Quotes erd
\end_inset

 is thus 
\begin_inset Formula $1-F(t)$
\end_inset

.
 That quantity is sometimes called the 
\begin_inset Quotes eld
\end_inset

stayer
\begin_inset Quotes erd
\end_inset

 function, or the 
\begin_inset Quotes eld
\end_inset

survival
\begin_inset Quotes erd
\end_inset

 function, and because both of those words start with 
\begin_inset Quotes eld
\end_inset

s
\begin_inset Quotes erd
\end_inset

, it is typically referred to as 
\begin_inset Formula $S(t)$
\end_inset

.
\begin_inset Formula 
\begin{equation}
S(t)=Prob(T>t)=1-F(t)\label{eq:Survivor1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Note that by definition,
\begin_inset Formula 
\begin{equation}
\frac{\partial S(t)}{\partial t}=-\frac{\partial F(t)}{\partial t}=-f(t)\label{eq:Survivor2}
\end{equation}

\end_inset


\begin_inset Newline newline
\end_inset

And, because 
\begin_inset Formula $dln(f)/dx=\frac{1}{f(x)}\frac{df}{dx}$
\end_inset

, it is also the case that
\begin_inset Formula 
\begin{equation}
\frac{\partial lnS(t)}{\partial t}=\frac{1}{S(t)}\frac{\partial S(t)}{\partial t}\label{eq:logSurvivor1}
\end{equation}

\end_inset


\begin_inset Newline newline
\end_inset

and if you connect the dots between these, you see
\begin_inset Formula 
\begin{equation}
\frac{\partial lnS(t)}{\partial t}=-\frac{f(t)}{S(t)}\label{eq:logSurvivor2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The change in the survivor function is the negative of the hazard function,
 which is defined next.
\end_layout

\begin_layout Subsection
Hazard function
\end_layout

\begin_layout Standard
Now, suppose I told you that an individual had survived until time 
\begin_inset Formula $m_{1}$
\end_inset

 (m is for milestone).
 Take a look at the next picture and tell me what you can infer from it:
\end_layout

\begin_layout Standard
\begin_inset VSpace 0.3cm
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename importfigs/mflatF.eps

\end_inset


\end_layout

\begin_layout Standard
\begin_inset VSpace 0.3cm
\end_inset


\end_layout

\begin_layout Standard
If I told you somebody lived until 
\begin_inset Formula $m_{1}$
\end_inset

, then you could make a more accurate statement about their probability
 of exit at 
\begin_inset Formula $m_{1}$
\end_inset

 than you could before I told you that.
 If I did not give you that information, you could only say their probability
 of exit is 
\begin_inset Formula $f(m_{1}).$
\end_inset

 But now, you know more! You know the probability they will exit at that
 time has to use 
\begin_inset Formula $S(m_{1})$
\end_inset

 as a denominator, since that is the total amount of 
\begin_inset Quotes eld
\end_inset

risk
\begin_inset Quotes erd
\end_inset

 left after reaching time 
\begin_inset Formula $m_{1}$
\end_inset

.
 
\end_layout

\begin_layout Standard
Given a unit lasts until 
\begin_inset Formula $t$
\end_inset

, then, the probability that unit will 
\begin_inset Quotes eld
\end_inset

exit
\begin_inset Quotes erd
\end_inset

 at that time is
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
h(t)=\frac{f(t)}{S(t)}\label{eq:hazard1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Harrell uses 
\begin_inset Formula $\lambda(t)$
\end_inset

 instead of 
\begin_inset Formula $h(t)$
\end_inset

 in his notation.
 Hazard is sometimes given exciting names, like the 
\emph on
instantaneous event
\emph default
 or 
\emph on
instantaneous failure rate.

\emph default
 
\end_layout

\begin_layout Standard
In light of equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:logSurvivor2"

\end_inset

, it is also true that:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
h(t)=-\frac{\partial ln\, S(t)}{\partial t}\label{eq:hazard2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
I tend to think of this as a pure probability exercise.
 The total probability of an exit at or after 
\begin_inset Formula $t$
\end_inset

 is 
\begin_inset Formula $S(t)$
\end_inset

 and the unconditional chance of exiting at 
\begin_inset Formula $t$
\end_inset

 is 
\begin_inset Formula $f(t)$
\end_inset

, so the conditional chance of exiting is 
\begin_inset Formula $h(t).$
\end_inset


\end_layout

\begin_layout Standard
If you want a formal proof of equation (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:hazard1"

\end_inset

), consult Harrell, p.
 395.
 Hazard is the probability of an 
\begin_inset Quotes eld
\end_inset

event
\begin_inset Quotes erd
\end_inset

 that occurs at time T will happen in a really small unit of time between
 
\begin_inset Formula $t$
\end_inset

 and 
\begin_inset Formula $t+\Delta t$
\end_inset

, divided by the probability that the event happens after 
\begin_inset Formula $t$
\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
h(t)=\frac{lim_{\Delta t\rightarrow0}\frac{Prob(t<T<t+\Delta t)}{\Delta t}}{Prob(t<T)}\label{eq:hazard3}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Harrel p.
 395 shows all the steps.
\end_layout

\begin_layout Standard
It is really just a lightly veiled application of Bayes's theorem, come
 to think of it.
 
\end_layout

\begin_layout Standard
Anyway, the function 
\begin_inset Formula $h(t)$
\end_inset

 is the so-called hazard function, or hazard rate.
 It has an interpretation that goes like 
\begin_inset Quotes eld
\end_inset

given a unit survives until t, what is the probability that it will die
 exactly at t.
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Standard
Before you go further, stop and note the importance of this:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f(t)=h(t)S(t)\label{eq:hazard4}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Its intertwined! Hazard function, cumulative hazard, survivor function...
\end_layout

\begin_layout Standard
The cumulative hazard function, often denoted as 
\begin_inset Formula $\Lambda(t)$
\end_inset

, is the 
\begin_inset Quotes eld
\end_inset

accumulated risk
\begin_inset Quotes erd
\end_inset

 up to time t.
 Cumulative risk never decreases: it is always either steady or increasing
 in t.
\begin_inset Formula 
\begin{equation}
\Lambda(t)=\int_{0}^{t}h(u)du\label{eq:intertwine1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Note, given equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:hazard2"

\end_inset

, that is:
\begin_inset Formula 
\begin{equation}
\Lambda(t)=\int_{0}^{t}-\frac{\partial ln\, S(u)}{\partial u}du\label{eq:intertwine2}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
\Lambda(t)=-ln\, S(t)\label{eq:intertwine3}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
S(t)=exp(-\Lambda(t))\label{eq:intertwine5}
\end{equation}

\end_inset


\begin_inset Newline newline
\end_inset

The survival curve is thus tightly tied to the accumulated hazard rate.
\end_layout

\begin_layout Section
No Covariates.
 Why bother?
\end_layout

\begin_layout Subsection
Constant hazard=exponential survival function
\end_layout

\begin_layout Standard
I don't know why anybody would want this, but suppose the hazard rate were
 a constant:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
h(t)=\lambda
\]

\end_inset


\end_layout

\begin_layout Standard
That is, no matter how far along one survives, the chance of exiting is
 fixed.
 If you think backward from there, then you can use your math skills to
 assert that 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f(t)=\lambda exp(-\lambda t)\label{eq:exponential1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
and
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
S(t)=exp(-\lambda t)\label{eq:exponential2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
and
\begin_inset Formula 
\begin{equation}
\Lambda(t)=\lambda t\label{eq:exponential3}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
and
\begin_inset Formula 
\begin{equation}
S(t)=exp(-\Lambda(t))\label{eq:exponential5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Maybe you don't know enough calculus to believe it, but you could learn
 it some day and see this is right.
\end_layout

\begin_layout Standard
In other words, if the hazard is a constant, then the Survivor function
 is an exponential function.
\end_layout

\begin_layout Subsection
Weibull hazard
\end_layout

\begin_layout Standard
Suppose you wanted to tell a story in which the hazard rate changes over
 time.
 Here would be a good starting point:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
h(t)=\lambda\alpha t^{\alpha-1}\label{eq:weibull1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
You can see the time-dependence of the hazard depends on 
\begin_inset Formula $\alpha$
\end_inset

, right?
\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\alpha$
\end_inset

 is bigger than 1, then the hazard rate gets bigger, there is 
\begin_inset Quotes eld
\end_inset

positive duration dependence.
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\alpha$
\end_inset

 is smaller than 1, then the exponent is negative, and the hazard gets smaller,
 and there is 
\begin_inset Quotes eld
\end_inset

negative duration dependence
\begin_inset Quotes erd
\end_inset

.
 
\end_layout

\begin_layout Standard
Because 
\begin_inset Formula $\alpha$
\end_inset

 determines the 
\begin_inset Quotes eld
\end_inset

shape
\begin_inset Quotes erd
\end_inset

 it is often called a shape parameter.
 
\end_layout

\begin_layout Standard
The coefficient 
\begin_inset Formula $\lambda$
\end_inset

 is the 
\begin_inset Quotes eld
\end_inset

scale
\begin_inset Quotes erd
\end_inset

 parameter.
 Not that adjusting 
\begin_inset Formula $\lambda$
\end_inset

 changes the hazard up and down.
\end_layout

\begin_layout Standard
Please note that the exponential model is a 
\begin_inset Quotes eld
\end_inset

special case
\begin_inset Quotes erd
\end_inset

 of the Weibull.
 If in the Weibull we found 
\begin_inset Formula $\alpha=1$
\end_inset

, then this would degenerate to an exponential model.
\end_layout

\begin_layout Standard
If you get on your math hat, you can figure out the f and F and S which
 imply the previous hazard rate.
 My notes have
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
S(t)=exp(-\lambda t^{\alpha})\label{eq:weibull2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
and I know from browsing the internet that
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f(t)=\alpha\lambda(t\lambda)^{\alpha-1}exp(-(t\lambda)^{\alpha})\label{eq:weibull3}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
And it is as obvious and plain as the nose on your face that
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
F(t)=1-\exp\left(-\left(t\lambda\right)^{\alpha}\right)\label{eq:weibull4}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Sometimes I see people who use different letters for these, and sometimes
 they write 
\begin_inset Formula $\frac{1}{\lambda}=\beta$
\end_inset

 and then they replace the 
\begin_inset Formula $\lambda$
\end_inset

 in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:weibull3"

\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f(t)=\frac{\alpha}{\beta}\left(\frac{t}{\beta}\right)^{\alpha-1}\exp\left(-\left(\frac{t}{\beta}\right)^{\alpha}\right)\label{eq:weibull5}
\end{equation}

\end_inset

Watch out if you go digging around for Weibull formulae, because it appears
 to me that it is against the law for any two authors to us the same letters
 and symbols.
\end_layout

\begin_layout Subsection
Gamma hazard.
\end_layout

\begin_layout Standard
Condgon (p.
 427) mentions the possibility that the hazard rate might be given by a
 model that depends on a Gamma variate.
 Suppose a Gamma distribution 
\begin_inset Formula $G(\gamma,\lambda)$
\end_inset

 with the density
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f(t)=\frac{\lambda}{\Gamma(\gamma)}(\lambda t)^{\gamma-1}\exp\left(-\lambda t\right)\label{eq:gamma1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The coefficients 
\begin_inset Formula $\gamma$
\end_inset

 and 
\begin_inset Formula $\lambda$
\end_inset

 are the shape and scale parameters, respectively.
\end_layout

\begin_layout Standard
Recall that the gamma function is just some number you can look up in a
 book or computer.
\end_layout

\begin_layout Standard
The cumulative distribution that goes along with this is somewhat magical
 as far as I can see.
 Writing down the formula for F(t) requires the 
\begin_inset Quotes eld
\end_inset

incomplete gamma function
\begin_inset Quotes erd
\end_inset

 
\begin_inset Formula $\Gamma_{x}(\gamma)$
\end_inset

 and as far as I can see, for our purposes, it is just more distraction.
\end_layout

\begin_layout Standard
Notice, if 
\begin_inset Formula $\gamma=1$
\end_inset

 then this is the same as the exponential distribution.
 
\end_layout

\begin_layout Standard
The gamma model has a hazard function that is monotonic in t.
 It appears to me after considerable searching that there is no general
 closed form for the hazard function for all values of the parameters.
 Nevertheless, supposing 
\begin_inset Formula $\lambda=1$
\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
h(t)=\frac{t^{\gamma-1}e^{-t}}{\Gamma(\gamma)-\Gamma_{x}(\gamma)}\label{eq:gamma2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
We know, in general, that if 
\begin_inset Formula $\gamma\in(0,1)$
\end_inset

 then hazard decreases monotonically, while if 
\begin_inset Formula $\gamma>1$
\end_inset

 then the hazard increases from 0 to 
\begin_inset Formula $\lambda$
\end_inset

 as time goes from 0 to 
\begin_inset Formula $\infty$
\end_inset

.
\end_layout

\begin_layout Subsection
Nonparametric survival curves: K-M curves
\end_layout

\begin_layout Standard
I'll write something here someday.
\end_layout

\begin_layout Section
Proportional Hazards: finally some input variables
\end_layout

\begin_layout Standard
Donald Cox made the proportional hazards model famous.
 He pioneered many areas in modern statistics.
 The 
\begin_inset Quotes eld
\end_inset

Cox Proportional Hazards
\begin_inset Quotes erd
\end_inset

 model is a specific strategy for estimating regression coefficients.
 
\end_layout

\begin_layout Standard
Caution: Not all proportional hazards models are CPH models.
\end_layout

\begin_layout Subsection
General Proportional Hazard
\end_layout

\begin_layout Standard
The proportional hazards model assumes that the 
\begin_inset Quotes eld
\end_inset

time dependent
\begin_inset Quotes erd
\end_inset

 hazard is multiplied by the part that depends on the input variables:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
h(t)=\lambda(t|X_{i})=\lambda_{0}(t)\cdot f(X_{i},b)
\]

\end_inset

The hazard is a function of time which reflects a 
\begin_inset Quotes eld
\end_inset

baseline hazard
\begin_inset Quotes erd
\end_inset

 
\begin_inset Formula $\lambda_{0}(t)$
\end_inset

 multiplied against a function of the input variables.
 
\end_layout

\begin_layout Standard
Please note the significance.
 
\end_layout

\begin_layout Quote

\series bold
Hazard separates into two parts
\series default
, an individual dependent part and a part that depends only on time.
\end_layout

\begin_layout Standard
I like this notation 
\begin_inset Formula $\lambda(t|X)$
\end_inset

 as a way of remembering that hazard is separate from the function 
\begin_inset Formula $\lambda_{0}(t)$
\end_inset

.
 It is very common, but not absolutely necessary, to assume
\begin_inset Formula 
\[
f(x,b)=exp\left(Xb\right)
\]

\end_inset


\begin_inset Newline newline
\end_inset

So the general definition of a proportional hazards model is
\begin_inset Formula 
\begin{equation}
h(t)=\lambda_{0}(t)\cdot exp(Xb)\label{eq:propor1}
\end{equation}

\end_inset


\begin_inset Newline newline
\end_inset

Fiddle that around in various ways:
\begin_inset Formula 
\[
h(t)=e^{ln\lambda_{0}(t)+Xb}
\]

\end_inset


\begin_inset Newline newline
\end_inset

So you can think of the hazard rate as being the exponentiated sum of the
 logged time-related element and the input variables.
 In other words, if you did have the hazard value as an observed quantity,
 and you wanted to use it in a regression model, you would need logged time
 as an input.
\end_layout

\begin_layout Standard
To refer to a case i, we might write
\begin_inset Formula 
\begin{equation}
h_{i}(t)=\lambda_{0}(t)\cdot exp(X_{i}b)\label{eq:propor2}
\end{equation}

\end_inset

 Note the premise here is that all cases at time 
\begin_inset Formula $t$
\end_inset

 share a certain amount of hazard, 
\begin_inset Formula $\lambda_{0}(t)$
\end_inset

 and the there is case-specific customization with 
\begin_inset Formula $exp(X_{i}b)$
\end_inset

.
\end_layout

\begin_layout Section
The Cox Proportional Hazards model: nonParametric approach.
\end_layout

\begin_layout Standard
There is a division of opinion on this.
 Box-Steffensmeier and Jones cite authorities who discourage the use of
 the CPH model, whereas Harrell seems to be more enthusiastic.
 Take your pick, apply your diagnostics.
\end_layout

\begin_layout Standard
Some people call this a nonparametric approach because we don't end up estimatin
g the baseline hazard at all.
 In fact, we don't even end up using the precise times to event data.
 We only use the ranking of the event times.
 But I prefer to say it is semi parametric, because we do estimate the 
\begin_inset Formula $b$
\end_inset

's.
 
\end_layout

\begin_layout Subsection
About conditional probability
\end_layout

\begin_layout Standard
Suppose the following events might happen: {A,B,C,D,E,F}.
 Suppose these are independent events, and the probability of each one is
 given by P(A), P(B), ..., P(F), and, of course, these sum up to 1.0.
 
\end_layout

\begin_layout Standard
Suppose you are told that either A, B, or C happened.
 What is the probability that the thing which happened was A?
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
P(A|A\, or\, B\, or\, C)=\frac{P(A)}{P(A)+P(B)+P(C)}\label{eq:Conditional}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Cox's model depends on ordering and conditional probability
\end_layout

\begin_layout Standard
Cox's argument was that we should not worry about the function 
\begin_inset Formula $\lambda_{0}(t).$
\end_inset

 Its not our main focus.
 We want regression coefficients! 
\end_layout

\begin_layout Standard
So, how can we make 
\begin_inset Formula $\lambda_{0}(t)$
\end_inset

 disappear? The event time for a case 
\begin_inset Formula $i$
\end_inset

 is 
\begin_inset Formula $T_{i}$
\end_inset

 and the 
\begin_inset Formula $risk\, Set$
\end_inset

 at time 
\begin_inset Formula $t$
\end_inset

 is the set of observations (
\begin_inset Formula $j\in risk\, Set)$
\end_inset

 such that the event did not occur, meaning 
\begin_inset Formula $T_{j}>t$
\end_inset

.
 Let's figure out the probability that observation 1 will be the first one
 to have an event.
 Observe (following the logic in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Conditional"

\end_inset

):
\begin_inset Formula 
\begin{equation}
\frac{h_{1}(t)}{\sum_{i\in risk\, Set}h_{i}(t)}=\frac{\lambda_{0}(t)\cdot exp(X_{1}b)}{\sum_{i\in risk\, Set}\lambda_{0}(t)\cdot exp(X_{i}b)}=\frac{exp(X_{1}b)}{\sum_{t<T_{i}}exp(X_{i}b)}\label{eq:Cox1}
\end{equation}

\end_inset

 Whew! 
\begin_inset Formula $\lambda_{0}(t)$
\end_inset

 disappeared! What we are left with is the probability that case 1 will
 be first.
\end_layout

\begin_layout Standard
Now find a way to justify that: If only one case can fail at time 
\begin_inset Formula $t$
\end_inset

 (a big assumption that haunts CPR applications), then the one which fails
 will be case 
\begin_inset Formula $1$
\end_inset

 is given by the hazard experienced by case 
\begin_inset Formula $1$
\end_inset

 divided by the hazard experienced by all of the cases.
 
\end_layout

\begin_layout Standard
Note this is somewhat similar to the probability that 
\begin_inset Formula $y=1$
\end_inset

 in a logistic regression model, but it is not exactly the same thing.
 Its not remotely similar, really, because the numerator concerns case i
 and the denominator concerns cases other than i which have longer survival
 times.
\end_layout

\begin_layout Standard
So we take a data set and sort the observations in order of event time,
 so 
\begin_inset Formula $T_{1}<T_{2}<T_{3}...<T_{N}$
\end_inset

 and then we figure the conditional probability that each case which does
 fail will be the one that actually does, as given for case 1 in expression
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Cox1"

\end_inset

.
 
\end_layout

\begin_layout Standard
Each observation in the dataset has a conditional calculation which indicates
 the probability that it will be next.
 It will be 
\begin_inset Quotes eld
\end_inset

next
\begin_inset Quotes erd
\end_inset

 in the sense that we know which others 
\begin_inset Quotes eld
\end_inset

already happened
\begin_inset Quotes erd
\end_inset

 and we know which others did not happen yet.
 Now, we know from ordered data where all of the events fall into line,
 so you can see where this is heading.
 The model is predicting the ordering of events across the sample.
\end_layout

\begin_layout Standard
It's not maximum likelihood because we aren't maximizing the full probability
 of observing each observation.
 Instead, we are looking at the probability that the observed order will
 be replicated by each case considered one at a time.
\end_layout

\begin_layout Standard
This approach is called 
\begin_inset Quotes eld
\end_inset

partial likelihood
\begin_inset Quotes erd
\end_inset

.
 Cox showed that maximizing partial likelihood is going to give parameter
 estimates similar to full maximum likelihood, but partial likelihood is
 easier to calculate and makes some impossible problems 
\begin_inset Quotes eld
\end_inset

do-able.
\begin_inset Quotes erd
\end_inset

 
\end_layout

\begin_layout Standard
Cox Proportional Hazards (CPH) models are sometimes written with the stipulation
 that all event times are observed.
 None of the observations can be censored:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
partialL(b)=\prod_{i=1}^{N}\frac{exp(X_{i}b)}{\sum_{t<T_{j}}exp(X_{j}b)}\label{eq:Cox2}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
ln\, partialL(b)=\sum_{i=1}^{N}\left\{ ln\left[exp(X_{i}b)\right]-ln\left[\sum_{t<T_{j}}exp(X_{j}b)\right]\right\} \label{eq:Cox3}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
=\sum_{i=1}^{N}\left\{ X_{i}b-ln\left[\sum_{t<T_{j}}exp(X_{j}b)\right]\right\} \label{eq:Cox4}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Note the following:
\end_layout

\begin_layout Enumerate
There's no constant in a CPH model.
 If there is a constant in the variable matrix 
\begin_inset Formula $X_{i}$
\end_inset

, then the division described in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Cox2"

\end_inset

 will result in its elimination from the model (division of 
\begin_inset Formula $exp(b_{o})/exp(b_{0})$
\end_inset

) makes the constant disappear.
\end_layout

\begin_layout Enumerate
We CAN deal with ties.
 As Harrell explains, the 
\begin_inset Quotes eld
\end_inset

one failure at a time
\begin_inset Quotes erd
\end_inset

 restriction that justifies this approach has been a source of trouble,
 but workarounds have been proposed.
 Breslow's method seems to be the most widely used, but it is perhaps not
 so accurate (see Harrell, p.
 467).
\end_layout

\begin_layout Enumerate
Stratified CPH models are possible.
 If you think the assumption that underlies 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Cox2"

\end_inset

 is too strong, perhaps the problem is that your data includes 
\begin_inset Quotes eld
\end_inset

separate strata
\begin_inset Quotes erd
\end_inset

 of observations.
 If you have 2 collections of observations, and you think they have different
 baseline hazards, you can specify a model in which the 2 collections have
 the same 
\begin_inset Formula $b$
\end_inset

 coefficients but the baseline hazards are treated separately.
\end_layout

\begin_layout Enumerate
Diagnostics exist.
 There are ways to find out if the hazards are not truly proportional.
 That means the 
\begin_inset Quotes eld
\end_inset

input variables
\begin_inset Quotes erd
\end_inset

 in 
\begin_inset Formula $exp(X_{i}b)$
\end_inset

 include some component that depends on 
\begin_inset Formula $t$
\end_inset

, such as 
\begin_inset Formula $exp(X_{i}b+log(t))$
\end_inset

or so forth.
 If this is the case, then the 
\begin_inset Quotes eld
\end_inset

explanatory part
\begin_inset Quotes erd
\end_inset

 of the model is no longer truly proportional to the time-based part.
\end_layout

\begin_layout Section
Parametric Hazards models
\end_layout

\begin_layout Standard
The term 
\begin_inset Quotes eld
\end_inset

hazard model
\begin_inset Quotes erd
\end_inset

 became synonymous with the Cox proportional hazards model, but is is not
 always necessarily so.
 The alternative approach is a maximum likelihood approach that 
\end_layout

\begin_layout Enumerate
requires us to specify a formula for 
\begin_inset Formula $\lambda_{0}(t)$
\end_inset


\end_layout

\begin_layout Enumerate
allows us to incorporate 
\begin_inset Quotes eld
\end_inset

censored
\begin_inset Quotes erd
\end_inset

 observations in our analysis.
\end_layout

\begin_layout Standard
The likelihood of observing a particular exit at time t is given by the
 hazard rate for that value of t times the Survivorfunction.
 If we observe all cases to completion, then the likelihood is simply found
 by multiplying the hazard values.
 
\end_layout

\begin_layout Standard
Maximize the log likelihood:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
lnL=\sum_{i=1}^{N}ln(f(t_{i}))\label{eq:logLParametric}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The probability that an event will be observed at time 
\begin_inset Formula $t$
\end_inset

 is the hazard rate at time 
\begin_inset Formula $t$
\end_inset

 multiplied by the surivival rate for 
\begin_inset Formula $t$
\end_inset

: 
\begin_inset Formula $h(t)\cdot S(t)=\lambda_{0}(t)\cdot exp(X\beta)\cdot S(t)$
\end_inset

.
 If the event times are not all observed when the study comes to an end,
 then we have 
\begin_inset Quotes eld
\end_inset

censored
\begin_inset Quotes erd
\end_inset

 data.
 If we have, say, an observation that has not exited, that means it is still
 a survivor, and the exit time is unknown.
 If the study ends at 
\begin_inset Formula $t_{end},$
\end_inset

 the probability of such an observation is 
\begin_inset Formula $S(t_{end})$
\end_inset

.
 To put the two possibilities into one expression, introduce the dummy variable
 
\begin_inset Formula $\delta_{i}$
\end_inset

 which has the value 0 if an observation is 
\begin_inset Quotes eld
\end_inset

censored
\begin_inset Quotes erd
\end_inset

 and 1 if it is an observed failure.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
likelihood\, of\, case\, i:\,\,\,\, h(t_{i})^{\delta_{i}}S(t_{i})\label{eq:param2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
If the case is censored, then the h() part gets thrown away because it is
 raised to the power of 0, and then only the 
\begin_inset Formula $S()$
\end_inset

 part is taken into account.
\end_layout

\begin_layout Section
Time-Varying Covariates
\end_layout

\begin_layout Standard
Wading through the literature, it seems to me there is not a complete consensus
 on the incorporation of time-varying covariates.
 Here is my best understanding of the situation.
\end_layout

\begin_layout Subsection
Extend the CPH model 
\end_layout

\begin_layout Standard
Recall the CPH partial likelihood is:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
partialL(b)=\prod_{i=1}^{N}\frac{exp(X_{i}b)}{\sum_{t<T_{j}}exp(X_{j}b)}\label{eq:CPHTVC1}
\end{equation}

\end_inset


\begin_inset Newline newline
\end_inset

What if the variable 
\begin_inset Formula $X_{j}$
\end_inset

is not fixed in time, but varies.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
partialL(b)=\prod_{i=1}^{N}\frac{exp(X_{it}b)}{\sum_{t<T_{j}}exp(X_{jt}b)}\label{eq:CPHTVC2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The numerator is easy to calculate.
 Instead of a 
\begin_inset Quotes eld
\end_inset

constant
\begin_inset Quotes erd
\end_inset

 
\begin_inset Formula $X_{i}$
\end_inset

, we just put in the observed value of 
\begin_inset Formula $X_{it}$
\end_inset

 at time t.
 This assumes that the hazard depends only on the current setting of the
 variable 
\begin_inset Formula $X,$
\end_inset

 not past values.
\end_layout

\begin_layout Standard
The denominator is superficially more complicated, but really it is just
 as simple.
 The hazard depends only on the value of 
\begin_inset Formula $X$
\end_inset

 at the current time, so customize each denominator.
\end_layout

\begin_layout Subsection
Parametric Survival: Petersen's approach
\end_layout

\begin_layout Standard
Trond Peterson.
 1986.
 Fitting Parametric Survival Models with Time-Dependent Covariates.
 Applied Statistics.
 35(3): 281-288
\end_layout

\begin_layout Standard
Begin with all the apparatus of the parametric survival model.
\end_layout

\begin_layout Standard
Suppose you take a full (as opposed to partial) likelihood approach.
 Then each term in the likelihood has to be the probability of having an
 event at time 
\begin_inset Formula $t_{i}$
\end_inset

.
 But we don't have a way to calculate the Survivor function that takes into
 account the fact that the input is varying in time.
 Peterson considers 2 kinds of covariates: 
\end_layout

\begin_layout Standard
\begin_inset Formula $X_{it}$
\end_inset

 varies in time in discrete 
\begin_inset Quotes eld
\end_inset

jumps
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $Z_{it}$
\end_inset

 varies in time continuously
\end_layout

\begin_layout Standard
First, just 
\begin_inset Quotes eld
\end_inset

assume
\begin_inset Quotes erd
\end_inset

 hazard depends on time-varying variables
\begin_inset Formula 
\begin{equation}
h(t)=\lambda(t|X_{it},Z_{i}(t))=lim_{\Delta t\rightarrow0}\frac{P[t\leq T<t+\Delta t|T\ge t,X_{it},Z_{i}(t)]}{\Delta t}\label{eq:Peterson1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Since 
\begin_inset Formula $X_{it}$
\end_inset

 is observed to change at certain intervals, it means we can 
\begin_inset Quotes eld
\end_inset

break up
\begin_inset Quotes erd
\end_inset

 time so that 
\begin_inset Formula $X_{it}$
\end_inset

 is constant within the intervals.
 Divide time into sections marked of by
\begin_inset Formula 
\begin{eqnarray}
t_{0} & = & 0\,\,\,\, t_{0}<t_{1}<t_{2}...<t_{k}\label{eq:Peterson2}
\end{eqnarray}

\end_inset

Create a sequence of hazard functions for case i at 
\begin_inset Formula $t{}_{1}$
\end_inset

, 
\begin_inset Formula $t_{2}$
\end_inset

,..., 
\begin_inset Formula $t_{k}$
\end_inset

.
 These are separate functions which apply in the intervals:
\begin_inset Formula 
\begin{equation}
\lambda_{i1}=\lambda_{1}(t|X_{i1}),\lambda_{i2}=\lambda_{2}(t|X_{i2})...,\lambda_{ik}=\lambda_{k}(t|X_{it_{k}})\label{eq:Peterson3}
\end{equation}

\end_inset

On each little time slice, we can figure the hazard rate.
 So, if there were no continuous variables like 
\begin_inset Formula $Z_{i}(t)$
\end_inset

 involved, we could think of the Survivor function as the probability of
 surviving a string of hazards.
 
\begin_inset Formula 
\begin{equation}
S(t_{k}|X_{it})=exp[-\int_{0}^{t_{1}}\lambda_{1}(s|X_{i0})ds]\times exp[-\int_{t_{1}}^{t_{2}}\lambda_{2}(s|X_{it_{2}})ds]...\times exp[-\int_{t_{k-1}}^{t_{k}}\lambda_{k}(s|X_{it_{k}})]\label{eq:Peterson4}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The elements in the likelihood function are exactly like the usual parametric
 hazard model, with the noncensored cases contributing observed event times
 contributing the probability of an event at the observed time times the
 Survival function.
 The probability of event 
\begin_inset Quotes eld
\end_inset

at the observed time
\begin_inset Quotes erd
\end_inset

 is given by one of the 
\begin_inset Formula $\lambda_{ij}$
\end_inset

 above, and the Survival curve 
\begin_inset Formula 
\[
P(t=t_{i})=\lambda_{it_{i}}\cdot S(t_{i}|X_{it})
\]

\end_inset


\begin_inset Newline newline
\end_inset

And a censored case contributes the 
\begin_inset Formula $S(t_{end\, point})$
\end_inset

 value.
\end_layout

\begin_layout Standard
Peterson shows how, if you have continuously varying inputs like 
\begin_inset Formula $Z_{i}(s)$
\end_inset

, then the survivor function 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Peterson4"

\end_inset

 is easily written to take those variables into account.
 Each term is just 
\begin_inset Formula 
\[
\lambda(s|X_{it},Z_{i}(s))
\]

\end_inset


\end_layout

\begin_layout Subsection
Counting Process Model
\end_layout

\begin_layout Standard
The counting process model is the most general, and most recent, development.
 I believe that it can eventually replace all of the thing we think of as
 survival/duration analysis.
 However, the conceptualization is not quite so easy to understand as proportion
al hazard.
\end_layout

\begin_layout Standard
Counting Process models allow multiple events per unit and they more-or-less
 automatically incorporate time-varying covariates.
\end_layout

\begin_layout Standard
It is difficult to explain this without throwing a lot of notation around.
 The Appendix 2 in Hosmer & Lemeshow explains some details and refers us
 to other readings.
 Personally, I think volume 2 of the S-Plus statistical manual is a good
 place to start.
\end_layout

\begin_layout Subsubsection*
Revise the risk set
\end_layout

\begin_layout Standard
Let's attack the problem by starting with a generalization of the risk set
 as used in the CPH model.
 Recall the risk set was stated as the observations for which the survival
 time exceeded the current time, 
\begin_inset Formula $t<T_{i}$
\end_inset

.
 We can generalize that to allow for the possibility that subjects go in
 and out of the risk set by defining an indicator variable 
\begin_inset Formula $Y_{it}$
\end_inset

, which is coded 
\begin_inset Formula $1$
\end_inset

 if 
\begin_inset Formula $i$
\end_inset

 is in the risk set at time 
\begin_inset Formula $t$
\end_inset

, 
\begin_inset Formula $0$
\end_inset

 otherwise.
 If you adopt that idea, the CPH model can be stated:
\begin_inset Formula 
\begin{equation}
partialL(b)=\prod_{i=1}^{N}\frac{exp(X_{i}b)}{\sum Y_{it}\cdot exp(X_{j}b)}\label{eq:Cox2}
\end{equation}

\end_inset


\begin_inset Newline newline
\end_inset

If the dependent phenomenon is something that can happen over and over again,
 then one might have a column of observations 
\begin_inset Formula $Y_{it}$
\end_inset

 that switches back and forth.
\end_layout

\begin_layout Subsubsection*
Reconceptualize censored events
\end_layout

\begin_layout Standard
It is implicit in the previous that we are treating the censored observations--t
he ones for which the observation period ends before the event is observed--just
 like observations for which we do have event observations later in the
 data.
 Censored cases are no longer thought of as incomplete data (S-plus II,
 p.
 358).
 
\end_layout

\begin_layout Subsubsection*
Reconceptualize event
\end_layout

\begin_layout Standard
The 
\begin_inset Quotes eld
\end_inset

counting process
\begin_inset Quotes erd
\end_inset

 idea begins with the premise that we want to understand the accumulated
 number of events that a case 
\begin_inset Formula $i$
\end_inset

 experiences up to time 
\begin_inset Formula $t$
\end_inset

.
 That is called 
\begin_inset Formula $N_{it}$
\end_inset

.
\end_layout

\begin_layout Standard
If you have a project in which the cases 
\begin_inset Quotes eld
\end_inset

die
\begin_inset Quotes erd
\end_inset

, then 
\begin_inset Formula $N_{it}$
\end_inset

can only take on the values 
\begin_inset Formula $0$
\end_inset

 and 
\begin_inset Formula $1$
\end_inset

.
 But you can imagine a model of heart attacks in which there are repeats
 that don't kill the patient.
\end_layout

\begin_layout Standard
The S-plus manual (p.
 358) says you should think of an individual has having a set of observations,
 one for each 
\begin_inset Quotes eld
\end_inset

interval
\begin_inset Quotes erd
\end_inset

 on which data is gathered.
 Each interval observed for a case contributes one row, and in that row
 we have this information:
\end_layout

\begin_layout Description
\begin_inset Formula $s_{ij}$
\end_inset

 
\begin_inset Quotes eld
\end_inset

start
\begin_inset Quotes erd
\end_inset

 time for the interval of risk represented by this row 
\end_layout

\begin_layout Description
\begin_inset Formula $t_{ij}$
\end_inset

 
\begin_inset Quotes eld
\end_inset

stop
\begin_inset Quotes erd
\end_inset

 time for the interval of risk represented by this row
\end_layout

\begin_layout Description
\begin_inset Formula $\delta_{ij}$
\end_inset

 
\begin_inset Quotes eld
\end_inset

event
\begin_inset Quotes erd
\end_inset

 indicator variable, 1 if event occurred for observation of case i in time
 j
\end_layout

\begin_layout Description
\begin_inset Formula $x_{ij}$
\end_inset

 covariates that apply in the interval represented by the row
\end_layout

\begin_layout Description
\begin_inset Formula $k_{ij}$
\end_inset

 the stratum (cluster) that includes this observation
\end_layout

\begin_layout Subsubsection*
CPH is easy
\end_layout

\begin_layout Standard
Re-organize the data so that there is one row for each unique combination
 of input values.
 Make sure each line has a 
\begin_inset Quotes eld
\end_inset

start
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

stop
\begin_inset Quotes erd
\end_inset

 time variable.
\end_layout

\begin_layout Standard
The Survival object in R is created with a command like
\end_layout

\begin_layout Standard
\begin_inset Formula $mySurv<-Surv(start=s,stop=t,event=\delta)$
\end_inset

 
\begin_inset Newline newline
\end_inset

and that is used on the left hand side of a regression model, 
\end_layout

\begin_layout Standard
\begin_inset Formula $coxph(mySurv\sim x+y,data=dat,method="breslow",robust=T)$
\end_inset


\end_layout

\begin_layout Section
Frailty (heterogeneity)
\end_layout

\begin_layout Standard
Remember when we worked on 
\begin_inset Quotes eld
\end_inset

count
\begin_inset Quotes erd
\end_inset

 models with heterogeneity, and we put in a rather simple error term to
 account for 
\begin_inset Quotes eld
\end_inset

overdispersion
\begin_inset Quotes erd
\end_inset

 of observed data? 
\end_layout

\begin_layout Standard
If you don't remember, I'll wait until you look it up.
 
\end_layout

\begin_layout Standard
Hmm.
\end_layout

\begin_layout Standard
Hmm.
\end_layout

\begin_layout Standard
Now suppose the duration model is based on the Weibull distribution:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
h(t_{i})=\alpha t_{i}^{\alpha-1}\exp(Xb+\theta_{i})
\]

\end_inset


\end_layout

\begin_layout Standard
The beauty of the exponential functional form is that sums inside the brackets
 are easily brought out of the brackets, as in:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
h(t_{i})=\alpha t_{i}^{\alpha-1}\exp(Xb)\exp(\theta_{i})
\]

\end_inset


\end_layout

\begin_layout Standard
And if we want to make 
\begin_inset Formula $\theta_{i}$
\end_inset

 appear 
\begin_inset Quotes eld
\end_inset

all by itself
\begin_inset Quotes erd
\end_inset

 as a multiplier, we just use the sleight of hand of redefining the original
 
\begin_inset Formula $\theta=ln(\delta)$
\end_inset

 and so this hazard rate is just the original one multiplied by the random
 variable 
\begin_inset Formula $\delta.$
\end_inset

 
\end_layout

\begin_layout Standard
So we want to insert a variable 
\begin_inset Formula $\delta$
\end_inset

 that has an expected value of 1, which means it 
\begin_inset Quotes eld
\end_inset

doesn't matter
\begin_inset Quotes erd
\end_inset

 on average, but some cases are higher and some are lower.
 One way to achieve that is to use a Gamma distribution for 
\begin_inset Formula $\delta$
\end_inset

 because Gamma(1,1) has a mean of 1 and a variance of 1.
 
\end_layout

\begin_layout Section
It ain't necessarily so....
\end_layout

\begin_layout Subsection
Nonproportional hazards are possible
\end_layout

\begin_layout Standard
Not all hazard models incorporate input variables with hazards in a proportional
 way.
 Congdon (p.
 427) refers to the logistic hazard model:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
h(t)=\frac{1}{\sigma[\frac{e^{t-Xb}}{1+e^{t-Xb}}]}
\]

\end_inset


\end_layout

\begin_layout Subsection
Nonmonotonic hazards are possible.
\end_layout

\begin_layout Standard
The log-logistic model has 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
h(t)=\alpha(\frac{t}{\theta})^{\alpha-1}/\left[\theta+t^{\alpha}\theta^{1-\alpha}\right]
\]

\end_inset


\end_layout

\end_body
\end_document
